<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Pomodoro ‚Äî Emoji</title>

    <!-- —Å—Ç–∏–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞ -->
    <link rel="stylesheet" href="./src/css/tokens.css" />
    <link rel="stylesheet" href="./src/css/base.css" />
    <link rel="stylesheet" href="./src/css/layout.css" />
    <link rel="stylesheet" href="./src/css/app.css" />
    <link rel="stylesheet" href="./src/css/tomato.css" />
    <link rel="stylesheet" href="./src/css/sidebar.css" />

    <!-- –ª–æ–∫–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ iOS-–∫–æ–ª—ë—Å -->
    <style>
      /* ===== iOS-like wheels ===== */
      .wheels {
        display: grid;
        gap: 12px;
      }
      .wheel-card {
        position: relative;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 12px;
        background: var(--sb-card);
        border: 1px solid var(--sb-line);
        border-radius: 20px;
        padding: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.18),
          inset 0 1px 0 rgba(255, 255, 255, 0.04);
      }
      .wheel-wrap {
        display: grid;
        grid-template-rows: auto 1fr;
        gap: 8px;
        min-width: 0;
      }
      .wheel-label {
        text-align: center;
        font-weight: 900;
        letter-spacing: 0.2px;
        color: var(--muted);
        font-size: 12px;
        text-transform: uppercase;
      }

      .wheel {
        position: relative;
        height: 184px;
        overflow: auto;
        border-radius: 14px;
        background: radial-gradient(
            120% 60% at 50% -10%,
            rgba(255, 255, 255, 0.06),
            transparent 60%
          ),
          linear-gradient(
            180deg,
            rgba(255, 255, 255, 0.02),
            rgba(0, 0, 0, 0.06)
          );
        border: 1px solid var(--sb-line);
        scroll-snap-type: y mandatory;
        -webkit-overflow-scrolling: touch;
        mask-image: linear-gradient(
          to bottom,
          transparent 0,
          #000 16%,
          #000 84%,
          transparent 100%
        );
      }
      .wheel::-webkit-scrollbar {
        width: 0;
        height: 0;
      }

      .wheel ul {
        list-style: none;
        margin: 0;
        padding: 8px 0;
        display: grid;
        gap: 6px;
      }
      .wheel li {
        height: 40px;
        display: grid;
        place-items: center;
        font-weight: 800;
        font-size: 18px;
        letter-spacing: 0.2px;
        color: var(--muted);
        scroll-snap-align: center;
        transform: translateZ(0);
        transition: transform 0.18s ease, color 0.18s ease, opacity 0.18s ease;
        opacity: 0.55;
      }
      .wheel li.is-active {
        color: var(--ink);
        transform: scale(1.08);
        opacity: 1;
        text-shadow: 0 0 1px rgba(0, 0, 0, 0.2);
      }

      /* —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è ¬´–ª–µ–Ω—Ç–∞¬ª –≤—ã–±–æ—Ä–∞ */
      .wheel-highlight {
        pointer-events: none;
        position: absolute;
        left: 12px;
        right: 12px;
        top: 50%;
        height: 40px;
        transform: translateY(-50%);
        border-radius: 10px;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.08),
          rgba(255, 255, 255, 0.02)
        );
        box-shadow: inset 0 0 0 1px var(--sb-line),
          inset 0 10px 16px rgba(0, 0, 0, 0.12),
          inset 0 -10px 16px rgba(0, 0, 0, 0.1);
      }

      /* –∞–¥–∞–ø—Ç–∏–≤: –Ω–∞ —É–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö —Ü–∏–∫–ª—ã –≤–Ω–∏–∑ */
      @media (max-width: 480px) {
        .wheel-card {
          grid-template-columns: 1fr 1fr;
        }
        .wheel-card .wheel-wrap:last-child {
          grid-column: 1 / -1;
        }
      }

      /* –º–æ—Å—Ç–æ–≤—ã–µ inputs —Å–∫—Ä—ã—Ç—ã ‚Äî –Ω—É–∂–Ω—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Ç–µ–∫—É—â–∏–º sidebar.js */
      .inputs-bridge.hidden {
        display: none !important;
      }
    </style>
  </head>

  <body class="night">
    <main class="app" id="app">
      <header class="topbar">
        <div class="brand">üçÖ</div>
        <div class="actions">
          <button id="themeToggle" class="icon-btn" aria-label="–¢–µ–º–∞">
            üåô
          </button>
          <button id="openSettings" class="icon-btn" aria-label="–ú–µ–Ω—é">
            ‚ò∞
          </button>
        </div>
      </header>

      <section class="stage" aria-live="polite">
        <button
          class="tomato"
          id="tomatoBtn"
          aria-label="–°—Ç–∞—Ä—Ç/–ü–∞—É–∑–∞"
          aria-pressed="false"
        >
          <svg
            class="tomato__progress"
            viewBox="0 0 360 360"
            aria-hidden="true"
          >
            <circle
              id="progressArc"
              cx="180"
              cy="180"
              r="168"
              fill="none"
              stroke="currentColor"
              stroke-width="10"
              stroke-linecap="round"
              style="transform: rotate(-90deg); transform-origin: 180px 180px"
            />
          </svg>
          <img
            class="tomato__img"
            src="./assets/img/tomato.png"
            alt="–ü–æ–º–∏–¥–æ—Ä"
            draggable="false"
          />
          <div class="tomato__shadow" aria-hidden="true"></div>
        </button>

        <div class="readout">
          <div id="time" class="time">25:00</div>
          <div id="phase" class="phase">–û—Ç–¥—ã—Ö–∞–µ–º üòå</div>
        </div>
      </section>

      <footer class="credit" aria-hidden="true"></footer>
    </main>

    <!-- –º–µ–Ω—é -->
    <div id="sidebarBackdrop" class="sb-backdrop" aria-hidden="true"></div>
    <aside id="sidebar" class="sb" aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏" aria-hidden="true">
      <div class="sb__inner">
        <!-- –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ -->
        <header class="sb__brand">
          <div class="logo">üçÖ</div>
          <div class="title">
            <strong>–ü–ª–∞–Ω –∑–∞–Ω—è—Ç–∏–π</strong>
            <span>–Ω–∞—Å—Ç—Ä–æ–π –∏–ª–∏ –≤—ã–±–µ—Ä–∏</span>
          </div>
        </header>

        <hr class="sb__divider" />

        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∫–ª–∞–¥–æ–∫ -->
        <div class="seg" role="tablist" aria-label="–ü–ª–∞–Ω –∑–∞–Ω—è—Ç–∏–π">
          <button
            class="seg__btn is-active"
            data-mode="build"
            role="tab"
            aria-selected="true"
          >
            –ù–∞—Å—Ç—Ä–æ–∏—Ç—å
          </button>
          <button
            class="seg__btn"
            data-mode="pick"
            role="tab"
            aria-selected="false"
          >
            –í—ã–±—Ä–∞—Ç—å
          </button>
        </div>

        <!-- –í–ö–õ–ê–î–ö–ê: –ù–ê–°–¢–†–û–ò–¢–¨ -->
        <section class="pane is-open" data-pane="build">
          <!-- iOS-like wheels -->
          <div class="wheels" aria-label="–ö–æ–ª—ë—Å–∏–∫–∏ –≤—ã–±–æ—Ä–∞">
            <div class="wheel-card">
              <div class="wheel-wrap">
                <div class="wheel-label">–§–æ–∫—É—Å</div>
                <div
                  class="wheel"
                  data-key="focus"
                  data-min="1"
                  data-max="180"
                  data-value="25"
                  aria-label="–§–æ–∫—É—Å (–º–∏–Ω)"
                ></div>
              </div>
              <div class="wheel-wrap">
                <div class="wheel-label">–ü–µ—Ä–µ—Ä—ã–≤</div>
                <div
                  class="wheel"
                  data-key="break"
                  data-min="1"
                  data-max="60"
                  data-value="5"
                  aria-label="–ü–µ—Ä–µ—Ä—ã–≤ (–º–∏–Ω)"
                ></div>
              </div>
              <div class="wheel-wrap">
                <div class="wheel-label">–¶–∏–∫–ª—ã</div>
                <div
                  class="wheel"
                  data-key="cycles"
                  data-min="1"
                  data-max="20"
                  data-value="4"
                  aria-label="–¶–∏–∫–ª—ã"
                ></div>
              </div>
              <div class="wheel-highlight" aria-hidden="true"></div>
            </div>
          </div>

          <!-- –º–æ—Å—Ç –¥–ª—è —Ç–µ–∫—É—â–µ–π –ª–æ–≥–∏–∫–∏ sidebar.js (—Å–∫—Ä—ã—Ç—ã–µ inputs) -->
          <div class="inputs-bridge hidden" aria-hidden="true">
            <div class="grid2">
              <label class="pill in">
                <span>–§–æ–∫—É—Å, –º–∏–Ω</span>
                <input
                  id="bFocus"
                  type="number"
                  min="1"
                  max="180"
                  step="1"
                  value="25"
                />
              </label>
              <label class="pill in">
                <span>–ü–µ—Ä–µ—Ä—ã–≤, –º–∏–Ω</span>
                <input
                  id="bBreak"
                  type="number"
                  min="1"
                  max="60"
                  step="1"
                  value="5"
                />
              </label>
            </div>
            <label class="pill in">
              <span>–¶–∏–∫–ª—ã</span>
              <input
                id="bCycles"
                type="number"
                min="1"
                max="20"
                step="1"
                value="4"
              />
            </label>
          </div>

          <div class="plan__meta" id="bMeta">25/5 √ó4 ‚âà 120 –º–∏–Ω</div>

          <div id="bEditTag" class="edit-tag hidden">
            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: <b id="bEditName"></b>
          </div>

          <div class="row-between">
            <button id="bApply" class="btn">‚ñ∂ –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            <button id="bSaveToggle" class="btn ghost">
              üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–ª–∞–Ω
            </button>
          </div>

          <!-- –ü–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ -->
          <div id="bSaveBlock" class="save-row hidden">
            <label class="pill in">
              <span>–ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∞</span>
              <input
                id="bName"
                type="text"
                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –£—Ç—Ä–æ 2√ó25/5"
              />
            </label>
            <div class="row-between">
              <span class="plan__hint">–°–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ ¬´–ü–ª–∞–Ω—ã¬ª</span>
              <div class="row-between" style="gap: 8px">
                <button id="bCancelEdit" class="btn ghost hidden">
                  –û—Ç–º–µ–Ω–∞
                </button>
                <button id="bSave" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              </div>
            </div>
          </div>
        </section>

        <!-- –í–ö–õ–ê–î–ö–ê: –í–´–ë–†–ê–¢–¨ -->
        <section class="pane" data-pane="pick">
          <div class="list scroll" id="listPlans"></div>
        </section>

        <div class="sb__spacer"></div>

        <div class="sb__footer">
          <button id="sbClose" class="sb__logout">
            ‚úï <span>–ó–∞–∫—Ä—ã—Ç—å</span>
          </button>
        </div>
      </div>
    </aside>

    <!-- –∑–≤—É–∫–∏ -->
    <audio
      id="sfxStart"
      preload="auto"
      src="data:audio/mp3;base64,//uQZ..."
    ></audio>
    <audio
      id="sfxEnd"
      preload="auto"
      src="data:audio/mp3;base64,//uQZ..."
    ></audio>

    <!-- –ª–æ–≥–∏–∫–∞ -->
    <script type="module" src="./src/js/sidebar.js"></script>
    <script type="module" src="./src/js/app.js"></script>

    <!-- –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–ª—ë—Å —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π -->
    <script type="module">
      const rowH = 40;
      const PAD = 3; // –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å–≤–µ—Ä—Ö—É/—Å–Ω–∏–∑—É, —á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–Ω–∞—è –±—ã–ª–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É
      const bridge = {
        focus: document.getElementById("bFocus"),
        break: document.getElementById("bBreak"),
        cycles: document.getElementById("bCycles"),
      };

      function makeList(min, max) {
        const ul = document.createElement("ul");
        for (let i = 0; i < PAD; i++)
          ul.appendChild(document.createElement("li")).textContent = "";
        for (let v = min; v <= max; v++) {
          const li = document.createElement("li");
          li.textContent = v;
          li.dataset.val = v;
          ul.appendChild(li);
        }
        for (let i = 0; i < PAD; i++)
          ul.appendChild(document.createElement("li")).textContent = "";
        return ul;
      }

      function scrollToVal(el, min, val, smooth = true) {
        const top = rowH * PAD + (val - min) * rowH;
        el.scrollTo({ top, behavior: smooth ? "smooth" : "auto" });
      }
      function nearestVal(el, min, max) {
        const idx = Math.round((el.scrollTop - rowH * PAD) / rowH);
        return Math.max(min, Math.min(max, min + idx));
      }
      function updateBridge(key, val) {
        const input = bridge[key];
        if (!input) return;
        input.value = String(val);
        input.dispatchEvent(new Event("input", { bubbles: true }));
        input.dispatchEvent(new Event("change", { bubbles: true }));
      }
      function markActive(el, min, max) {
        const val = nearestVal(el, min, max);
        el.querySelectorAll("li").forEach((li) =>
          li.classList.remove("is-active")
        );
        const idx = val - min + PAD; // —Å —É—á—ë—Ç–æ–º –±—É—Ñ–µ—Ä–∞
        const li = el.querySelectorAll("li")[idx];
        if (li) li.classList.add("is-active");
      }

      document.querySelectorAll(".wheel").forEach((wheelEl) => {
        const min = parseInt(wheelEl.dataset.min || "1", 10);
        const max = parseInt(wheelEl.dataset.max || "10", 10);
        const value = parseInt(wheelEl.dataset.value || String(min), 10);
        const key = wheelEl.dataset.key;

        const ul = makeList(min, max);
        wheelEl.appendChild(ul);

        // —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è + –∞–∫—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
        scrollToVal(wheelEl, min, value, false);
        updateBridge(key, value);
        markActive(wheelEl, min, max);

        let t;
        wheelEl.addEventListener("scroll", () => {
          clearTimeout(t);
          t = setTimeout(() => {
            const val = nearestVal(wheelEl, min, max);
            scrollToVal(wheelEl, min, val);
            updateBridge(key, val);
            markActive(wheelEl, min, max);
          }, 80);
        });

        wheelEl.addEventListener("click", (e) => {
          const li = e.target.closest("li[data-val]");
          if (!li) return;
          const val = parseInt(li.dataset.val, 10);
          scrollToVal(wheelEl, min, val);
          updateBridge(key, val);
          markActive(wheelEl, min, max);
        });

        // —á—Ç–æ–±—ã –∫–æ–ª–µ—Å–æ –º—ã—à–∏ –Ω–µ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–ª–æ –≤—Å—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ
        wheelEl.addEventListener(
          "wheel",
          (e) => {
            e.stopPropagation();
          },
          { passive: true }
        );
      });
    </script>
  </body>
</html>
